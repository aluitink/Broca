@using KristofferStrube.ActivityStreams
@using Broca.ActivityPub.Components.Services
@inject IObjectRendererRegistry RendererRegistry

@if (Object != null)
{
    @if (CustomRenderer != null)
    {
        <div class="activitypub-object-display @CssClass">
            @CustomRenderer(Object)
        </div>
    }
    else
    {
        var renderer = RendererRegistry.GetRenderer(Object.GetType());
        if (renderer != null)
        {
            <div class="activitypub-object-display @CssClass">
                @try
                {
                    @RendererRegistry.GetRenderFragment(Object)
                }
                catch (Exception ex)
                {
                    @if (ErrorTemplate != null)
                    {
                        @ErrorTemplate(ex.Message)
                    }
                    else
                    {
                        <div class="object-display-error">
                            <span class="error-icon">⚠️</span>
                            <span>Failed to render object: @ex.Message</span>
                        </div>
                    }
                }
            </div>
        }
        else if (ShowMissingRenderer)
        {
            <div class="activitypub-object-display @CssClass">
                <div class="object-display-no-renderer">
                    <span class="warning-icon">⚠️</span>
                    <span>No renderer for @Object.GetType().Name</span>
                </div>
            </div>
        }
        @* Skip rendering if no renderer available and ShowMissingRenderer is false *@
    }
}
else if (RenderEmpty != null)
{
    <div class="activitypub-object-display @CssClass">
        @RenderEmpty
    </div>
}
else if (ShowEmptyState)
{
    <div class="activitypub-object-display @CssClass">
        <div class="object-display-empty">
            <p>No content to display</p>
        </div>
    </div>
}

@code {
    /// <summary>
    /// Gets or sets the ActivityStreams object to display.
    /// </summary>
    [Parameter]
    public object? Object { get; set; }

    /// <summary>
    /// Gets or sets the content to display when the object is null.
    /// </summary>
    [Parameter]
    public RenderFragment? RenderEmpty { get; set; }

    /// <summary>
    /// Gets or sets the error template for rendering errors.
    /// </summary>
    [Parameter]
    public RenderFragment<string>? ErrorTemplate { get; set; }

    /// <summary>
    /// Gets or sets whether to show an empty state when object is null.
    /// </summary>
    [Parameter]
    public bool ShowEmptyState { get; set; } = false;

    /// <summary>
    /// Gets or sets whether to show a message when no renderer is available.
    /// When false, items without renderers are skipped entirely.
    /// </summary>
    [Parameter]
    public bool ShowMissingRenderer { get; set; } = false;

    /// <summary>
    /// Gets or sets additional CSS classes for the container.
    /// </summary>
    [Parameter]
    public string? CssClass { get; set; }

    /// <summary>
    /// Gets or sets a custom renderer to use instead of the registry.
    /// </summary>
    [Parameter]
    public RenderFragment<object>? CustomRenderer { get; set; }

    /// <summary>
    /// Gets or sets a callback when the object is clicked.
    /// </summary>
    [Parameter]
    public EventCallback<object> OnObjectClick { get; set; }
}
