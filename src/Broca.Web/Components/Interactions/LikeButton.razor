@* Like/favorite button with animation *@

<FluentButton Appearance="Appearance.Lightweight" OnClick="@HandleClick" Disabled="@(IsProcessing || Disabled)" Title="@(IsLiked ? "Unlike" : "Like")" Class="@($"like-button {(IsLiked ? "liked" : "")} {(IsAnimating ? "animating" : "")}")">
    @if (IsLiked)
    {
        <FluentIcon Value="@(new Icons.Filled.Size20.Heart())" Color="Color.Error" />
    }
    else
    {
        <FluentIcon Value="@(new Icons.Regular.Size20.Heart())" Color="Color.Neutral" />
    }
    @if (ShowCount && (LikeCount > 0 || IsLiked))
    {
        <span class="like-count">@FormatCount(LikeCount)</span>
    }
</FluentButton>

@code {
    [Parameter] public bool IsLiked { get; set; }
    [Parameter] public int LikeCount { get; set; }
    [Parameter] public bool ShowCount { get; set; } = true;
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public EventCallback<bool> OnLikeClick { get; set; }

    private bool IsProcessing { get; set; }
    private bool IsAnimating { get; set; }

    private async Task HandleClick()
    {
        if (IsProcessing) return;
        IsProcessing = true;
        IsAnimating = true;
        var previousState = IsLiked;
        IsLiked = !IsLiked;
        LikeCount += IsLiked ? 1 : -1;
        StateHasChanged();
        try { await OnLikeClick.InvokeAsync(previousState); }
        catch { IsLiked = previousState; LikeCount += IsLiked ? 1 : -1; throw; }
        finally { IsProcessing = false; StateHasChanged(); await Task.Delay(600); IsAnimating = false; StateHasChanged(); }
    }

    private string FormatCount(int count) => count >= 1000000 ? $"{count / 1000000.0:F1}M" : count >= 1000 ? $"{count / 1000.0:F1}K" : count.ToString();
}

<style>
    .like-button { display: inline-flex; align-items: center; gap: 0.375rem; transition: all 0.2s ease; }
    .like-button.animating fluent-icon { animation: likeAnimation 0.6s ease; }
    .like-button:hover:not(:disabled) { transform: scale(1.05); }
    .like-count { font-size: 0.875rem; font-weight: 500; user-select: none; }
    @@keyframes likeAnimation { 0%, 100% { transform: scale(1); } 15% { transform: scale(1.3); } 30% { transform: scale(0.9); } 45% { transform: scale(1.15); } 60% { transform: scale(0.95); } 75% { transform: scale(1.05); } }
</style>
